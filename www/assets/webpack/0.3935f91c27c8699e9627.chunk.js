(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"./src/Template/TplConfig.tsx":
/*!************************************!*\
  !*** ./src/Template/TplConfig.tsx ***!
  \************************************/
/*! exports provided: TplConfig */function(t,e,n){"use strict";n.r(e),n.d(e,"TplConfig",function(){return o});var s=n(/*! tslib */"./node_modules/tslib/tslib.es6.js"),a=n(/*! react */"react"),i=n(/*! ../Skynar/EntitySelect */"./src/Skynar/EntitySelect.tsx"),r=new Headers;r.set("Content-Type","text/json;charset=UTF-8");var o=function(t){function e(e){var n=t.call(this,e)||this;return n.state={active:0,config:n.props.config?Object.assign({},n.props.config):null},n.save=n.save.bind(n),n}return s.__extends(e,t),e.prototype.onChange=function(t){console.log(t)},e.prototype.updateItem=function(t,e){var n=Object.assign({},this.state.config);n[t]=e,this.setState({config:n})},e.prototype.input=function(t,e,n){void 0===n&&(n="text");var s=this.state.config&&"string"==typeof this.state.config[t],i=s?this.state.config[t]:"Disabled";return a.createElement(c,{key:t,active:s,value:i,label:e,type:n,onChange:this.updateItem.bind(this,t)})},e.prototype.list=function(t,e,n){void 0===n&&(n="text");var s=this.state.config&&"object"==typeof this.state.config[t],i=s?this.state.config[t]:"Disabled";return a.createElement(l,{key:t,active:s,value:i,label:e,type:n,onChange:this.updateItem.bind(this,t)})},e.prototype.save=function(t){t.preventDefault();var e=t.currentTarget;e.disabled=!0,e.innerHTML='\n\t\t\t<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n\t\t\tСохраняю...\n\t\t\t',fetch(location.pathname+".json",{headers:r,method:"POST",body:JSON.stringify(this.state.config),credentials:"include"}).then(function(t){200==t.status?(e.innerHTML='\n\t\t\t\t\t<i class="fa fa-check" aria-hidden="true"></i> Сохранено\n\t\t\t\t',setTimeout(function(){e.disabled=!1,e.innerHTML='\n\t\t\t\t\t\t<i class="fa fa-floppy-o" aria-hidden="true"></i> Сохранить настройки\n\t\t\t\t\t'},3e3)):e.innerHTML="\n\t\t\t\t\tПри сохранении возникла ошибка!\n\t\t\t\t"})},e.prototype.render=function(){return a.createElement("div",{className:"tpl_config"},this.input("subject","Тема письма"),a.createElement("div",{className:"form-group"},a.createElement("label",null,"Сервер для рассылки"),a.createElement(i.default,{onChange:this.updateItem.bind(this,"from"),value:this.state.config.from,multiple:!1,name:"from",url:this.props.url})),this.input("from_name","От кого"),this.list("to","TO"),this.list("cc","CC"),this.list("bcc","BCC"),a.createElement("div",{className:"form-group text-right"},a.createElement("button",{className:"btn btn-main save-settings",onClick:this.save},a.createElement("i",{className:"fa fa-floppy-o","aria-hidden":"true"})," Сохранить настройки")))},e}(a.Component),l=function(t){function e(e){var n=t.call(this,e)||this;return n.state={emails:Object.keys(n.props.value).map(function(t){return[t,n.props.value[t]]})},n.add=n.add.bind(n),n.upd=n.upd.bind(n),n}return s.__extends(e,t),e.prototype.upd=function(){this.props.onChange(this.state.emails.reduce(function(t,e){return t[e[0]]=e[1],t},{}))},e.prototype.update=function(t,e,n){var s=this.state.emails.slice();s[t][e]=n,this.setState({emails:s},this.upd)},e.prototype.add=function(t){t.preventDefault();var e=this.state.emails.slice();e.push(["",""]),this.setState({emails:e},this.upd)},e.prototype.remove=function(t,e){e.preventDefault();var n=this.state.emails.slice();n.splice(t,1),this.setState({emails:n},this.upd)},e.prototype.render=function(){var t=this;return this.props.active&&a.createElement("fieldset",{className:this.props.active?"":"disabled"},a.createElement("p",null,this.props.label),a.createElement("div",null,console.log(this.state.emails),this.props.active&&this.state.emails.map(function(e,n){return a.createElement("span",{key:n},a.createElement(c,{active:!0,label:"Name",value:e[1],onChange:t.update.bind(t,n,1)}),a.createElement(c,{active:!0,label:"Email",value:e[0],onChange:t.update.bind(t,n,0),type:"email"}),a.createElement("button",{className:"remove",onClick:t.remove.bind(t,n)},a.createElement("i",{className:"fi fi-delete"})))}),this.props.active&&a.createElement("button",{className:"add",key:"b",onClick:this.add},"+")))},e}(a.Component),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s.__extends(e,t),e.prototype.onChange=function(t){this.props.onChange(t.target.value)},e.prototype.onblur=function(t){t.target.value},e.prototype.render=function(){return a.createElement("div",{className:"form-group"},a.createElement("span",{className:this.props.active?"input":"disabled input"},a.createElement("label",null,this.props.label),a.createElement("input",{value:this.props.value,className:"form-control",onBlur:this.onblur.bind(this),placeholder:this.props.label,onChange:this.onChange.bind(this),type:this.props.type||"text",disabled:!this.props.active})))},e}(a.Component)},"./src/Template/TplEdit.scss":
/*!***********************************!*\
  !*** ./src/Template/TplEdit.scss ***!
  \***********************************/
/*! no static exports found */function(t,e,n){},"./src/Template/TplEdit.tsx":
/*!**********************************!*\
  !*** ./src/Template/TplEdit.tsx ***!
  \**********************************/
/*! exports provided: default */function(t,e,n){"use strict";n.r(e);var s=n(/*! tslib */"./node_modules/tslib/tslib.es6.js"),a=n(/*! react */"react"),i=n(/*! react-ace */"./node_modules/react-ace/lib/index.js"),r=n.n(i),o=n(/*! ./TplConfig */"./src/Template/TplConfig.tsx"),l=n(/*! ./TplResultSet */"./src/Template/TplResultSet.tsx"),c=(n(/*! brace/mode/smarty.js */"./node_modules/brace/mode/smarty.js"),n(/*! brace/theme/monokai.js */"./node_modules/brace/theme/monokai.js"),n(/*! ./TplEdit.scss */"./src/Template/TplEdit.scss"),function(t){function e(e){var n=t.call(this,e)||this;return n.state={results:[n.props.result],current:0,text:n.props.text},n.onChange=n.onChange.bind(n),n.refResult=n.refResult.bind(n),n.save=n.save.bind(n),n}return s.__extends(e,t),e.prototype.onChange=function(t){this.setState({text:t})},e.prototype.refResult=function(t){this.rs=t},e.prototype.save=function(t){var e=this;t.preventDefault();var n=t.currentTarget;n.disabled=!0,n.innerHTML='\n\t\t\t<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n\t\t\tСохраняю...\n\t\t\t',fetch("",{method:"PUT",body:this.state.text,credentials:"include"}).then(function(t){return 200==t.status?(n.innerHTML='\n\t\t\t\t\t\t<i class="fa fa-check" aria-hidden="true"></i> Сохранено\n\t\t\t\t\t',setTimeout(function(){n.disabled=!1,n.innerHTML='\n\t\t\t\t\t\t\t<i class="fa fa-floppy-o" aria-hidden="true"></i> Сохранить настройки\n\t\t\t\t\t\t'},3e3)):n.innerHTML="\n\t\t\t\t\t\tПри сохранении возникла ошибка!\n\t\t\t\t\t",t.text()}).then(function(t){return e.rs.addResult(t)})},e.prototype.render=function(){return a.createElement("div",{className:"tpl_edit"},a.createElement("section",{className:"mb-5"},a.createElement(o.TplConfig,{config:this.props.config,url:this.props.url})),a.createElement("section",{className:"mb-5"},a.createElement("h3",{className:"h5"},"HTML редактор"),a.createElement(r.a,{mode:"smarty",theme:"monokai",name:"tpl",onChange:this.onChange,fontSize:14,showPrintMargin:!0,showGutter:!0,highlightActiveLine:!0,value:this.state.text,setOptions:{showLineNumbers:!0,tabSize:3}}),a.createElement("div",{className:"text-right mt-3"},a.createElement("button",{className:"btn btn-main save-settings",onClick:this.save},a.createElement("i",{className:"fa fa-floppy-o","aria-hidden":"true"})," Сохранить шаблон"))),a.createElement("section",{className:""},a.createElement("h3",{className:"h5"},"Предпросмотр письма"),a.createElement("div",{className:"container-fluid letter-page p-5"},a.createElement("div",{className:"row justify-content-md-center"},a.createElement("div",{className:"col col-lg-8"},a.createElement(l.default,{result:this.props.result,ref:this.refResult}))))))},e}(a.Component));e.default=c},"./src/Template/TplResultSet.tsx":
/*!***************************************!*\
  !*** ./src/Template/TplResultSet.tsx ***!
  \***************************************/
/*! exports provided: default */function(t,e,n){"use strict";n.r(e);var s=n(/*! tslib */"./node_modules/tslib/tslib.es6.js"),a=n(/*! react */"react"),i=function(t){function e(e){var n=t.call(this,e)||this;return n.state={results:[n.props.result],current:0},n.refiframe=n.refiframe.bind(n),n.updateFrame=n.updateFrame.bind(n),n}return s.__extends(e,t),e.prototype.addResult=function(t){var e=this.state.results.slice();e.push(t),this.setState({results:e,current:e.length-1})},e.prototype.onChange=function(t){console.log(t)},e.prototype.updateFrame=function(){if(this.iframe){var t=this.iframe.contentWindow.document;t.open(),t.write(this.getCurrentResult(this.state)),t.close()}},e.prototype.componentDidUpdate=function(t,e){this.getCurrentResult(e)!=this.getCurrentResult(this.state)&&this.updateFrame()},e.prototype.getCurrentResult=function(t){return"string"==typeof t.results[t.current]?t.results[t.current]:t.results[t.results.length-1]},e.prototype.refiframe=function(t){this.iframe=t,this.updateFrame()},e.prototype.render=function(){return a.createElement("div",{className:"tpl_result"},a.createElement("iframe",{frameBorder:"0",allowFullScreen:!0,ref:this.refiframe}))},e}(a.Component);e.default=i}}]);