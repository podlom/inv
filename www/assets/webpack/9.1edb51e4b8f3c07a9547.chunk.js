(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"./src/Mail/Guide.tsx":function(t,e,i){"use strict";i.r(e);var n,a,s=i("./node_modules/tslib/tslib.es6.js"),l=i("react");!function(t){t[t.props=0]="props",t[t.import=1]="import",t[t.template=2]="template",t[t.send=3]="send"}(n||(n={})),function(t){t[t.wait=0]="wait",t[t.success=1]="success",t[t.fail=2]="fail"}(a||(a={}));var o=function(t){function e(e){var i=t.call(this,e)||this;return i.state={mid:e.mid,mailings:i.props.mailings},i.selectMailing=i.selectMailing.bind(i),i.addMailing=i.addMailing.bind(i),void 0===i.state.mailings&&i.loadMailings(),i}return s.b(e,t),e.prototype.render=function(){var t=this,e=void 0;return this.state.mid&&!(e=this.state.mailings.find(function(e){return e.id==t.state.mid}))&&this.props.mailing&&this.props.mailing.id==this.state.mid&&(e=this.props.mailing),l.createElement("div",{className:"mail_guide"},e?l.createElement(c,{mailing:e,back:this.selectMailing.bind(this,0),updateMailing:this.updateMailing}):l.createElement(r,{onSelect:this.selectMailing,mailings:this.state.mailings,addMailing:this.addMailing,basepath:this.props.basepath}))},e.prototype.loadMailings=function(){var t=this;fetch(this.props.basepath+".json?count=1000",{credentials:"include"}).then(function(t){return t.json()}).then(function(e){t.setState({mailings:e.items})})},e.prototype.selectMailing=function(t){this.setState({mid:t})},e.prototype.addMailing=function(t){var e=[t].concat(this.state.mailings);this.setState({mailings:e,mid:t.id})},e.prototype.updateMailing=function(t){var e=this.state.mailings.map(function(e){return e.id==t.id?t:e});this.setState({mailings:e,mid:t.id})},e}(l.Component);e.default=o;var r=function(t){function e(e){var i=t.call(this,e)||this;return i.state={text:"",disabled:!1},i.onText=i.onText.bind(i),i.onNew=i.onNew.bind(i),i}return s.b(e,t),e.prototype.render=function(){var t=this;return l.createElement("article",{id:"mailinglist"},l.createElement("header",null,l.createElement("div",{className:"breadcrumbs"},"Select Mailing"),l.createElement("div",{className:"actions"},l.createElement("input",{type:"text",required:!0,onChange:this.onText,value:this.state.text,placeholder:"Enter name"}),l.createElement("button",{onClick:this.onNew,disabled:this.state.text.length<3},"create mailing"))),"object"==typeof this.props.mailings&&this.props.mailings.map?l.createElement("div",{className:"list mailing"},this.props.mailings.map(function(e){return l.createElement("div",{key:e.id,className:"item",onClick:t.select.bind(t,e)},e.title)})," "):l.createElement("div",{className:"loading"},"Loading..."))},e.prototype.onText=function(t){this.setState({text:t.target.value})},e.prototype.onNew=function(){var t=this;this.state.text.replace(/\s/g,"").length>=3&&fetch(this.props.basepath+"/add.json",{credentials:"include",method:"POST",body:"entity[name]="+encodeURIComponent(this.state.text),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){return t.json()}).then(function(e){t.props.addMailing(e.entity),t.setState({disabled:!1})}).catch(function(e){t.setState({disabled:!1})})},e.prototype.select=function(t,e){this.props.onSelect(t.id)},e}(l.Component),c=function(t){function e(e){var i=t.call(this,e)||this;return i.onFile=i.onFile.bind(i),i}return s.b(e,t),e.prototype.componentDidMount=function(){this.props},e.prototype.render=function(){return l.createElement("article",{id:"mailingview"},l.createElement("header",null,l.createElement("div",{className:"breadcrumbs"},l.createElement("a",{href:"#back",onClick:this.props.back},"<Mailing")," / ",this.props.mailing.title)),"object"==typeof this.props.mailing.stats?l.createElement("div",{className:"steps"},l.createElement("div",{className:"step1"},l.createElement("h3",null,"1. Import recipients"),l.createElement("label",null,"Select file: ",l.createElement("input",{type:"file",accept:".csv",onChange:this.onFile})))):l.createElement("div",{className:"loading"},"Loading..."))},e.prototype.onFile=function(t){var e=t.target.files.length>0?t.target.files[0]:null;this.setState({csvfile:e})},e}(l.Component)}}]);