(window.webpackJsonp=window.webpackJsonp||[]).push([["Mail"],{"./src/Mail/Guide.tsx":
/*!****************************!*\
  !*** ./src/Mail/Guide.tsx ***!
  \****************************/
/*! exports provided: default */function(t,e,i){"use strict";i.r(e);var n,a,s=i(/*! tslib */"./node_modules/tslib/tslib.es6.js"),l=i(/*! react */"react");!function(t){t[t.props=0]="props",t[t.import=1]="import",t[t.template=2]="template",t[t.send=3]="send"}(n||(n={})),function(t){t[t.wait=0]="wait",t[t.success=1]="success",t[t.fail=2]="fail"}(a||(a={}));var r=function(t){function e(e){var i=t.call(this,e)||this;return i.state={mid:e.mid,mailings:i.props.mailings},i.selectMailing=i.selectMailing.bind(i),i.addMailing=i.addMailing.bind(i),void 0===i.state.mailings&&i.loadMailings(),i}return s.__extends(e,t),e.prototype.render=function(){var t=this,e=void 0;return this.state.mid&&!(e=this.state.mailings.find(function(e){return e.id==t.state.mid}))&&this.props.mailing&&this.props.mailing.id==this.state.mid&&(e=this.props.mailing),l.createElement("div",{className:"mail_guide"},e?l.createElement(c,{mailing:e,back:this.selectMailing.bind(this,0),updateMailing:this.updateMailing}):l.createElement(o,{onSelect:this.selectMailing,mailings:this.state.mailings,addMailing:this.addMailing,basepath:this.props.basepath}))},e.prototype.loadMailings=function(){var t=this;fetch(this.props.basepath+".json?count=1000",{credentials:"include"}).then(function(t){return t.json()}).then(function(e){t.setState({mailings:e.items})})},e.prototype.selectMailing=function(t){this.setState({mid:t})},e.prototype.addMailing=function(t){var e=[t].concat(this.state.mailings);this.setState({mailings:e,mid:t.id})},e.prototype.updateMailing=function(t){var e=this.state.mailings.map(function(e){return e.id==t.id?t:e});this.setState({mailings:e,mid:t.id})},e}(l.Component);e.default=r;var o=function(t){function e(e){var i=t.call(this,e)||this;return i.state={text:"",disabled:!1},i.onText=i.onText.bind(i),i.onNew=i.onNew.bind(i),i}return s.__extends(e,t),e.prototype.render=function(){var t=this;return l.createElement("article",{id:"mailinglist"},l.createElement("header",null,l.createElement("div",{className:"breadcrumbs"},"Select Mailing"),l.createElement("div",{className:"actions"},l.createElement("input",{type:"text",required:!0,onChange:this.onText,value:this.state.text,placeholder:"Enter name"}),l.createElement("button",{onClick:this.onNew,disabled:this.state.text.length<3},"create mailing"))),"object"==typeof this.props.mailings&&this.props.mailings.map?l.createElement("div",{className:"list mailing"},this.props.mailings.map(function(e){return l.createElement("div",{key:e.id,className:"item",onClick:t.select.bind(t,e)},e.title)})," "):l.createElement("div",{className:"loading"},"Loading..."))},e.prototype.onText=function(t){this.setState({text:t.target.value})},e.prototype.onNew=function(){var t=this;this.state.text.replace(/\s/g,"").length>=3&&fetch(this.props.basepath+"/add.json",{credentials:"include",method:"POST",body:"entity[name]="+encodeURIComponent(this.state.text),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){return t.json()}).then(function(e){t.props.addMailing(e.entity),t.setState({disabled:!1})}).catch(function(e){t.setState({disabled:!1})})},e.prototype.select=function(t,e){this.props.onSelect(t.id)},e}(l.Component),c=function(t){function e(e){var i=t.call(this,e)||this;return i.onFile=i.onFile.bind(i),i}return s.__extends(e,t),e.prototype.componentDidMount=function(){this.props},e.prototype.render=function(){return l.createElement("article",{id:"mailingview"},l.createElement("header",null,l.createElement("div",{className:"breadcrumbs"},l.createElement("a",{href:"#back",onClick:this.props.back},"<Mailing")," / ",this.props.mailing.title)),"object"==typeof this.props.mailing.stats?l.createElement("div",{className:"steps"},l.createElement("div",{className:"step1"},l.createElement("h3",null,"1. Import recipients"),l.createElement("label",null,"Select file: ",l.createElement("input",{type:"file",accept:".csv",onChange:this.onFile})))):l.createElement("div",{className:"loading"},"Loading..."))},e.prototype.onFile=function(t){var e=t.target.files.length>0?t.target.files[0]:null;this.setState({csvfile:e})},e}(l.Component)},"./src/Mail/Mailer.tsx":
/*!*****************************!*\
  !*** ./src/Mail/Mailer.tsx ***!
  \*****************************/
/*! exports provided: default */function(t,e,i){"use strict";i.r(e);var n=i(/*! tslib */"./node_modules/tslib/tslib.es6.js"),a=i(/*! react */"react"),s=function(t){function e(e){var i=t.call(this,e)||this;return i.state={active:!1,delay:5,stats:e.stats.map(function(t){return parseInt(t)})},i.start=i.start.bind(i),i.stop=i.stop.bind(i),i.tick=i.tick.bind(i),i.fetch=i.fetch.bind(i),i.changeDelay=i.changeDelay.bind(i),i}return n.__extends(e,t),e.prototype.render=function(){var t=this.state.stats[0]+this.state.stats[1]+this.state.stats[2],e=this.state.stats[1]/t*100+"%",i=this.state.stats[2]/t*100+"%";return a.createElement("div",{className:"mailer"},a.createElement("h3",null,"Mailing status:",a.createElement("span",{className:"queue"},this.state.stats[0]),"/",a.createElement("span",{className:"done"},this.state.stats[1]),"/",a.createElement("span",{className:"fail"},this.state.stats[2]),"/",a.createElement("span",{className:"view"},this.state.stats[3]),"/",a.createElement("span",{className:"click"},this.state.stats[4])),a.createElement("div",{className:"progress"},a.createElement("div",{className:"done",style:{flex:"0 0 "+e}}),a.createElement("div",{className:"fail",style:{width:"0 0 "+i}}),a.createElement("div",{className:"other"})))},e.prototype.changeDelay=function(t){this.setState({delay:t.target.value})},e.prototype.start=function(){this.setState({active:!0},this.tick)},e.prototype.stop=function(){this.setState({active:!1}),clearTimeout(this.timer),this.timer=null},e.prototype.tick=function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.timer=setTimeout(this.fetch,1e3*this.state.delay)},e.prototype.fetch=function(){var t=this;fetch(this.props.url+".json",{credentials:"include"}).then(function(t){return t.json()}).then(function(e){e.stats?(t.setState({stats:e.stats.map(function(t){return parseInt(t)})}),t.state.active&&t.tick()):t.setState({active:!1})})},e}(a.Component);e.default=s},"./src/Mail/MailingAdd.tsx":
/*!*********************************!*\
  !*** ./src/Mail/MailingAdd.tsx ***!
  \*********************************/
/*! exports provided: default */function(t,e,i){"use strict";i.r(e);var n=i(/*! tslib */"./node_modules/tslib/tslib.es6.js"),a=i(/*! react */"react"),s=function(t){function e(e){var i=t.call(this,e)||this;return i.state={text:"",disabled:!1},i.onText=i.onText.bind(i),i.onNew=i.onNew.bind(i),i}return n.__extends(e,t),e.prototype.render=function(){return a.createElement("div",{className:"input-group"},a.createElement("input",{type:"text",className:"form-control",required:!0,onChange:this.onText,value:this.state.text,placeholder:"Введите название"}),a.createElement("div",{className:"input-group-append"},a.createElement("button",{className:"btn btn-main",onClick:this.onNew,disabled:this.state.text.length<3},"Создать рассылку")))},e.prototype.onText=function(t){this.setState({text:t.target.value})},e.prototype.onNew=function(){var t=this;this.state.text.replace(/\s/g,"").length>=3&&fetch(this.props.basepath+"/add.json",{credentials:"include",method:"POST",body:"entity[name]="+encodeURIComponent(this.state.text),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){return t.json()}).then(function(e){t.setState({disabled:!1}),location.href=t.props.basepath+"/"+e.entity.id}).catch(function(e){t.setState({disabled:!1})})},e}(a.Component);e.default=s},"./src/Mail/index.ts":
/*!***************************!*\
  !*** ./src/Mail/index.ts ***!
  \***************************/
/*! exports provided: Mailer, MailingAdd */function(t,e,i){"use strict";i.r(e);var n=i(/*! ./Mailer */"./src/Mail/Mailer.tsx");i.d(e,"Mailer",function(){return n.default});var a=i(/*! ./MailingAdd */"./src/Mail/MailingAdd.tsx");i.d(e,"MailingAdd",function(){return a.default})},react:
/*!************************!*\
  !*** external "React" ***!
  \************************/
/*! no static exports found */function(t,e){t.exports=React}}]);