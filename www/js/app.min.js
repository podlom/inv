jQuery(function(){$(document).foundation()});jQuery(function(){(function(t){if(t("[qType=formModal]").length){t("[qType=formModal]").formModal()}if(t("[qType=PhotoListAdd]").length){uuid=1;t("[qType=PhotoListAdd]").click(function(){clone=t(this).prev().clone();clone.find("input").val("");clone.find("img").attr("src","/img/thumb.128/skynar/images/filemanager/file.png");uid=uuid++;clone.find("[name]").each(function(){a=t(this).attr("name");e=a.lastIndexOf("]",a.length-2);s=a.lastIndexOf("[",e)+1;t(this).attr("name",a.substr(0,s)+"a"+uid+a.substr(e))});t(this).before(clone)});t(document).on("click",'[qType="PhotoListRemove"]',function(){t(this).parent().remove()})}window.url_slug=function(e,t){e=String(e);t=Object(t);var n={delimiter:"-",limit:undefined,lowercase:true,replacements:{},transliterate:typeof XRegExp==="undefined"?true:false};for(var r in n){if(!t.hasOwnProperty(r)){t[r]=n[r]}}var i={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Æ":"AE","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ő":"O","Ø":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ű":"U","Ý":"Y","Þ":"TH","ß":"ss","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","æ":"ae","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ð":"d","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ő":"o","ø":"o","ù":"u","ú":"u","û":"u","ü":"u","ű":"u","ý":"y","þ":"th","ÿ":"y","©":"(c)","Α":"A","Β":"B","Γ":"G","Δ":"D","Ε":"E","Ζ":"Z","Η":"H","Θ":"8","Ι":"I","Κ":"K","Λ":"L","Μ":"M","Ν":"N","Ξ":"3","Ο":"O","Π":"P","Ρ":"R","Σ":"S","Τ":"T","Υ":"Y","Φ":"F","Χ":"X","Ψ":"PS","Ω":"W","Ά":"A","Έ":"E","Ί":"I","Ό":"O","Ύ":"Y","Ή":"H","Ώ":"W","Ϊ":"I","Ϋ":"Y","α":"a","β":"b","γ":"g","δ":"d","ε":"e","ζ":"z","η":"h","θ":"8","ι":"i","κ":"k","λ":"l","μ":"m","ν":"n","ξ":"3","ο":"o","π":"p","ρ":"r","σ":"s","τ":"t","υ":"y","φ":"f","χ":"x","ψ":"ps","ω":"w","ά":"a","έ":"e","ί":"i","ό":"o","ύ":"y","ή":"h","ώ":"w","ς":"s","ϊ":"i","ΰ":"y","ϋ":"y","ΐ":"i","Ş":"S","İ":"I","Ç":"C","Ü":"U","Ö":"O","Ğ":"G","ş":"s","ı":"i","ç":"c","ü":"u","ö":"o","ğ":"g","А":"A","Б":"B","В":"V","Г":"G","Д":"D","Е":"E","Ё":"Yo","Ж":"Zh","З":"Z","И":"I","Й":"J","К":"K","Л":"L","М":"M","Н":"N","О":"O","П":"P","Р":"R","С":"S","Т":"T","У":"U","Ф":"F","Х":"H","Ц":"C","Ч":"Ch","Ш":"Sh","Щ":"Sh","Ъ":"","Ы":"Y","Ь":"","Э":"E","Ю":"Yu","Я":"Ya","а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"sh","ъ":"","ы":"y","ь":"","э":"e","ю":"yu","я":"ya","Є":"Ye","І":"I","Ї":"Yi","Ґ":"G","є":"ye","і":"i","ї":"yi","ґ":"g","Č":"C","Ď":"D","Ě":"E","Ň":"N","Ř":"R","Š":"S","Ť":"T","Ů":"U","Ž":"Z","č":"c","ď":"d","ě":"e","ň":"n","ř":"r","š":"s","ť":"t","ů":"u","ž":"z","Ą":"A","Ć":"C","Ę":"e","Ł":"L","Ń":"N","Ó":"o","Ś":"S","Ź":"Z","Ż":"Z","ą":"a","ć":"c","ę":"e","ł":"l","ń":"n","ó":"o","ś":"s","ź":"z","ż":"z","Ā":"A","Č":"C","Ē":"E","Ģ":"G","Ī":"i","Ķ":"k","Ļ":"L","Ņ":"N","Š":"S","Ū":"u","Ž":"Z","ā":"a","č":"c","ē":"e","ģ":"g","ī":"i","ķ":"k","ļ":"l","ņ":"n","š":"s","ū":"u","ž":"z"," ":"-"};for(var r in t.replacements){e=e.replace(RegExp(r,"g"),t.replacements[r])}if(t.transliterate){for(var r in i){e=e.replace(RegExp(r,"g"),i[r])}}var s=typeof XRegExp==="undefined"?RegExp("[^a-z0-9]+","ig"):XRegExp("[^\\p{L}\\p{N}]+","ig");e=e.replace(s,t.delimiter);e=e.replace(RegExp("["+t.delimiter+"]{2,}","g"),t.delimiter);e=e.substring(0,t.limit);e=e.replace(RegExp("(^"+t.delimiter+"|"+t.delimiter+"$)","g"),"");return t.lowercase?e.toLowerCase():e};if(t("a.confirm").length){t("a.confirm:not([disabled])").click(function(e){t("body").append('<div class="reveal-modal small" id="reveal_confirm"><div>'+t(this).attr("dialog")+'</div><a class="button close-reveal-modal round fright">Нет</a><a class="button success round fright" href="'+this.href+'">Да</a>'+"</div>");t("#reveal_confirm").reveal("close",function(){t("#reveal_confirm").remove()});e.preventDefault();return false})}if(t("[qType=gmap]").length){t("input[qType=gmap]").each(function(){t(this).after('<div class="gmap_wrap gmap_edit gmap_this"><input placeholder="Address" class="gmap_address"/><a href="#" class="button small round gmap_find">Find</a><div class="gmap"></div><i class="icon-checkmark button small round gmap_apply"> Apply</i></div>');var e=t(".gmap_this").removeClass("gmap_this");var r=e.find(".gmap");var i=e.find(".gmap_address");var o=e.find(".gmap_find");var u=new Gmap3Menu(r);var a=new Gmap3Menu(r);var f;var l={rightclick:function(e,t){f=e;if(!t.pixel){n=r.gmap3("get").getProjection().fromLatLngToPoint(e.getPosition());s=Math.pow(2,r.gmap3("get").getZoom());t.pixel=new google.maps.Point(n.x*s,n.y*s)}a.open(t)},dragend:function(e,n){if(r.gmap3({get:{id:"loc"}})!=e)return;r.gmap3({getaddress:{latLng:e.getPosition(),callback:function(e){if(e[0]&&e[0].formatted_address)t(this).parent().find(".gmap_address").val(e[0].formatted_address)}}})}};t(this).data("menu",u);marker_data={options:{draggable:true,icon:"http://maps.google.com/mapfiles/marker.png"},events:l};u.add(" Add marker","icon-plus",function(){u.close();m={latLng:current.latLng};t.extend(m,marker_data);r.gmap3({marker:m})});a.add(" Title","icon-edit",function(e){a.close();f.setTitle(window.prompt("Title",f.getTitle()));console.log(f)});a.add(" Remove","icon-remove",function(e){a.close();f.setMap(null);delete f});var c={map:{options:{zoom:5,center:[49.272105742788916,30.47241171875]},events:{rightclick:function(e,t){current=t;u.open(current)},click:function(){u.close()},dragstart:function(){u.close()},zoom_changed:function(){u.close()}}},marker:{events:l,options:{draggable:true}}};if(t(this).val()){n=JSON.parse(t(this).val());r.parent().find(".gmap_address").val(n.address);delete n.address;c=t.extend(true,c,n)}r.width(300).height(200).gmap3(c);o.click(function(e){e.preventDefault();t(this).parent().find(".gmap").gmap3({getlatlng:{address:t(this).prev().val(),callback:function(e){if(!e)return;t(this).gmap3({get:{name:"marker",id:"loc",callback:function(e){if(typeof e.setMap=="function")e.setMap(null);delete e}}});m={latLng:e[0].geometry.location,id:"loc",events:l};t.extend(m,marker_data);t(this).gmap3({marker:m});gapi=t(this).gmap3("get");gapi.setCenter(e[0].geometry.location);gapi.setZoom(16)}}})});i.autocomplete({source:function(){console.log(r);r.gmap3({getaddress:{address:t(this).val(),callback:function(e){if(!e)return;console.log(e);i.autocomplete("display",e,false)}}})},cb:{cast:function(e){return e.formatted_address},select:function(e){o.click()}}}).focus()});t(".gmap_apply").click(function(){_map=t(this).prev().gmap3("get");c=_map.getCenter();data={map:{options:{zoom:_map.getZoom(),center:[c.lat(),c.lng()]}},marker:{values:[]},address:t(this).parent().find(".gmap_address").val()};t(this).parent().find(".gmap").gmap3({get:{name:"marker",all:true,callback:function(e){m=[];mm=t(this).parent().find(".gmap").gmap3({get:{id:"loc"}});for(it in e){if(e[it].getPosition()&&e[it].getMap()){d={latLng:[e[it].getPosition().lat(),e[it].getPosition().lng()],options:{icon:e[it].getIcon(),title:e[it].getTitle()}};if(e[it]==mm){d.id="loc"}m.push(d)}}console.log(m,mm);data.marker.values=m;t(this).parent().parent().find("input[qType=gmap]").val(JSON.stringify(data))}}})});t(".gmap_address").keypress(function(e){if(e.keyCode==13){e.preventDefault();t(this).next().click();return false}});t("div[qType=gmap]").each(function(){def={map:{options:{zoom:5,center:[49.272105742788916,30.47241171875]}}};if(data=t(this).attr("qData")){t.extend(true,def,JSON.parse(data))}t(this).gmap3(def)})}})(jQuery)});jQuery.fn.formModal=function(e){onload=function(e){$("#modal").removeClass("loading");$("#modal").html("").append(e);$("#modal form").submit(function(e){e.preventDefault();$("#modal").html("").addClass("loading");jqxhr=jQuery.ajax({url:$(this).attr("action")+".phtml",type:$(this).attr("method"),data:$(this).serializeArray(),success:onload,error:function(e,t,n){$("#modal").removeClass("loading");$("#modal").html("").append(t+": "+n)}});$("#modal").data("jqxhr",jqxhr)})};this.click(function(e){e.preventDefault();jqxhr=jQuery.ajax({url:this.href+".phtml",success:onload,error:function(e,t,n){$("#modal").removeClass("loading");$("#modal").html("").append(t+": "+n)}});$("body").append('<div id="modal" class="reveal-modal large loading"></div>');$("#modal").data("jqxhr",jqxhr).reveal({close:function(){$("#modal").remove();jqxhr=$(this).data("jqxhr");if(jqxhr)jqxhr.abort();$("#modal").remove()}})})}