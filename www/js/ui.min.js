var UI
!function(t){var e=function(){function e(){}return e.init=function(n){$(n)
$.each(t,function(t,n){if("Controll"!=t)try{n.check(),e.load(t)}catch(o){console.log("loading: ",t,o)}})},e.load=function(n){var o=t[n]
o.check()
var i=$(document.body),a=i.find('[qtype="'+n+'"]')
$.each(a,function(t,n){var i=new o(n)
e.registry.push(i),$(n).attr("ui-id",e.registry.lastIndexOf(i))}),console.log("loading: ",n,a.length)},e.registry=[],e.services=[],e}()
t.Controll=e}(UI||(UI={}))
var UI
!function(t){var e=function(){function e(t){var n=this
this.variants=function(){var t={input:n.input.val(),types:["(regions)"]}
return e.getAutofill().getPlacePredictions(t,function(t,e){n.result=[],$.each(t,function(t,e){n.result.push(e.description)}),n.input.data("autocomplete").display(n.result,!1)}),n.result},this.input=$(t),window.loader.on("autocomplete",function(){n.input.autocomplete({source:n.variants,prefix:!1,delay:1,minLength:3,match:!1})})}return e.check=function(){return"undefined"!=typeof google&&"undefined"!=typeof google.maps?!0:(window.loader.on("google_maps",function(){t.Controll.load("AddressFilter"),console.log("loading")}),!0)},e.getAutofill=function(){return e.autofill||(e.autofill=new google.maps.places.AutocompleteService),e.autofill},e}()
t.AddressFilter=e}(UI||(UI={}))
var UI
!function(t){var e=function(){function t(t){var e=this
this.url=$(t).attr("href"),this.text=$(t).attr("data-text"),$(t).attr("href",null).attr("data-text",null).click(function(t){$(t.currentTarget)
t.preventDefault(),window.confirm(e.text?e.text:"Confirm action?")&&(location.href=e.url)})}return t.check=function(){return!0},t}()
t.confirm=e}(UI||(UI={}))
var UI
!function(t){var e=function(){function e(e){var n=this
this.save=function(t){if(console.log(window.e=t),"part"==n.node.attr("data-type")){var e=parseInt(n.node.attr("data-id")),o=n.node.attr("data-part")
if(-1==["text","title"].indexOf(o))return console.log("Unsupported data-part attribute: "+o)
var i={id:e}
i[o]="text"==o?t.getContent():$(t.targetElm).text(),$.ajax({url:"/!Page/part.json",data:i,method:"POST",success:function(t){window.infobox&&window.infobox.add("Successfuly saved!",{type:"success"})},error:function(t,e,n){window.infobox&&window.infobox.add("Save failed. "+e+"! "+n,{type:"alert"}),console.log("save failed!")}})}else console.log("Unsupported data-type attribute: "+n.node.attr("data-type"))
window.editor=t},this.change=function(e){n.editor||(n.editor=e,t.Unload.add(n.unload))},this.unload=function(){return n.editor.getContent()!=n.editor.start_content?"Page contains unsaved changes!":void 0},this.node=$(e),this.init_controll()}return e.prototype.init_controll=function(){if(!e.controll){e.controll=document.createElement("label"),e.controll.setAttribute("id","content_editable")
var n=document.createElement("input"),o=document.createElement("span")
o.textContent="Editable",n.setAttribute("type","checkbox"),e.controll.appendChild(n),e.controll.appendChild(o),document.body.appendChild(e.controll),$(e.controll).change(function(){for(var o=$(n).is(":checked"),i=0;i<t.Controll.registry.length;i++)t.Controll.registry[i]instanceof e&&t.Controll.registry[i].enable(o)})}},e.prototype.init=function(){var e=this,n={}
for(var o in t.Html.config)n[o]=t.Html.config[o]
n.inline=!0,n.save_onsavecallback=this.save,n.setup=function(t){t.on("change",e.change)},"text"!=this.node.attr("data-part")&&(n.toolbar="save | undo redo",n.menubar=!1,n.forced_root_block=!1,n.plugins=["save"],delete n.toolbar1,delete n.toolbar2),this.tinymce=this.node.tinymce(n)},e.prototype.enable=function(t){"undefined"==typeof t&&(t=!0),this.node.attr("contenteditable",t),t&&!this.tinymce&&this.init()},e.check=function(){if("undefined"==typeof $.fn.tinymce)throw loader.on("tinymce",function(){t.Controll.load("Html")}),"TinyMCE not loaded, yet?"},e}()
t.Content=e}(UI||(UI={}))
var UI
!function(t){var e=function(){function e(t){var n=$(t)
this.tinymce=n.tinymce(e.config)}return e.check=function(){if("undefined"==typeof $.fn.tinymce)throw loader.on("tinymce",function(){t.Controll.load("Html")}),"TinyMCE not loaded, yet?"},e.config={plugins:["autolink lists link image anchor","searchreplace visualblocks code fullscreen","save media table contextmenu paste"],schema:"html5",relative_urls:!1,file_browser_callback:function(t,e,n,o){var i=new FileManager.FileManager
$(i).one("close",function(e,n){var o=n.files.pop()
jQuery("#"+t).val(o.getFullUrl())}),i.open()},toolbar1:"undo redo |  save | styleselect  | outdent indent | bullist numlist | blockquote",toolbar2:"bold italic | alignleft aligncenter alignright alignjustify | forecolor backcolor  | link image",formats:{alignleft:{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img",classes:"left"},aligncenter:{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img",classes:"center"},alignright:{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table",classes:"right"},alignjustify:{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table",classes:"justify"}}},e}()
t.Html=e}(UI||(UI={}))
var UI
!function(t){var e=function(){function t(t){var e=this
this.onClose=function(t,n){var o=n.files.pop(),i=e.fm.root
"/"==i.substr(-1)&&(i=i.substr(0,i.length-1))
var a=o.path
"/"==a.substr(-1)&&(a=a.substr(0,a.length-1))
var r=i+o.path+"/"+o.name
e.input.val(r),e.image.attr("src","/img/thumbup.128"+r).attr("alt",o.name),e.fm=null},this.openfm=function(){e.fm=new FileManager.FileManager,$(e.fm).on("close",e.onClose),e.fm.open({cwd:e.root_dir})},this.root=$(t),this.input=this.root.find("input"),this.image=this.root.find("img"),this.root_dir=this.root.attr("data-path"),this.root.attr("data-path",null),this.root.on("click tap",function(t){t.preventDefault(),e.openfm()})}return t.check=function(){if("undefined"==typeof FileManager)throw"FileManager not loaded."},t}()
t.ImageInput=e}(UI||(UI={}))
var UI
!function(t){var e=function(){function e(t){var e=this
this.inc=0,this.onClose=function(t,n){$.each(n.files,function(t,n){var o=e.inc++,i=$("<span/>",{qtype:"Image",qId:o}),a=$("<img>",{src:n.getPreview(128)}),r=$("<input />").attr({type:"hidden",name:e.root.attr("name")+"[a"+o+"]",value:n.getFullUrl()})
e.img_list.append(i.append(a).append(r)),e.preview.val()||e.preview.val("a"+o)})},this.onMouseIn=function(t){var n=$(t.currentTarget),o=$("<a />").attr({href:"#remove",title:"remove","class":"remove"}).click(function(t){var n=$(t.currentTarget)
t.preventDefault(),e.preview.val(!1),n.parent().remove()}),i=$("<a />").attr({href:"#select",title:"select","class":"select"}).click(function(t){var n=$(t.currentTarget)
t.preventDefault(),e.preview.val(n.parent().attr("qId")),n.parent().addClass("current").siblings().removeClass("current")})
n.append(o).append(i)},this.onMouseOut=function(t){var e=$(t.currentTarget)
e.find("a").remove()},this.root=$(t),this.button=this.root.find('[qtype="ImagesListAdd"]'),this.img_list=this.root.find('[qtype="ImagesList"]'),this.preview=this.root.find('[qtype="PreviewImage"]'),this.button.click(function(t,n){t.preventDefault()
var o=new FileManager.FileManager
$(o).one("close",e.onClose),o.open()}),this.img_list.on("mouseenter","[qtype=Image]",this.onMouseIn).on("mouseleave","[qtype=Image]",this.onMouseOut)}return e.check=function(){if("undefined"==typeof FileManager)throw window.loader.on("filemanager",function(){t.Controll.load("ImagesListInput")}),"FileManager not loaded, yet?"},e}()
t.ImagesListInput=e}(UI||(UI={}))
var UI
!function(t){var e=function(){function e(t){var n=this
this.mapClick=function(t){n.marker?n.marker.setPosition(t.latLng):n.markerCreate(t.latLng),n.update()},this.root=$(t),this.lat=this.root.find('input[data-name="lat"]'),this.lng=this.root.find('input[data-name="lng"]'),this.loc=this.root.find('input[data-name="loc"]'),this.map=new google.maps.Map(this.root.find('[qtype="MapField"]')[0],{zoom:5,center:""!==this.lat.val()?new google.maps.LatLng(this.lat.val(),this.lng.val()):new google.maps.LatLng(48.491719684751274,32.147674890625034),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,rotateControl:!1,streetViewControl:!1}),""!==this.lat.val()&&this.markerCreate(new google.maps.LatLng(this.lat.val(),this.lng.val())),this.map.addListener("click",this.mapClick),this.root.find('[qtype="IconFind"]').click(function(){console.log("click",n.loc,n.loc.val()),n.loc.val().length>3&&e.getGeocoder().geocode({address:n.loc.val()},function(t,e){if(null!=t){n.lat.val(t[0].geometry.location.lat()),n.lng.val(t[0].geometry.location.lng()),n.loc.val(t[0].formatted_address)
var o={}
$.each(t[0].address_components,function(t,e){$.each(e.types,function(t,n){o[n]=e.long_name})}),console.log(o),n.marker?n.marker.setPosition(t[0].geometry.location):n.markerCreate(t[0].geometry.location)}})})}return e.getGeocoder=function(){return e.geocoder||(e.geocoder=new google.maps.Geocoder),e.geocoder},e.prototype.markerCreate=function(t){var e=this
this.marker&&this.marker.setMap(null),this.marker=new google.maps.Marker({map:this.map,position:t,draggable:!0}),this.marker.addListener("dragend",function(t){e.update()})},e.prototype.update=function(){var t=this;(this.lat.val()!=this.marker.getPosition().lat()||this.lng.val()!=this.marker.getPosition().lng())&&(this.lat.val(this.marker.getPosition().lat()),this.lng.val(this.marker.getPosition().lng()),e.getGeocoder().geocode({latLng:this.marker.getPosition()},function(e,n){null!=e&&t.loc.val(e[0].formatted_address)}))},e.check=function(){return"undefined"!=typeof google.maps?!0:void window.loader.on("google_maps",function(){t.Controll.load("MapInputPoint")})},e.geocoder=null,e}()
t.MapInputPoint=e}(UI||(UI={}))
var UI
!function(t){var e=function(){function t(t){var e=this
this.onChange=function(t){var n=$(t.currentTarget),o=parseInt(n.attr("data-level"))
if(n.nextAll("select").remove(),"undefined"!=typeof e.data[o]&&"undefined"!=typeof e.data[o][n.val()]){var i={name:n.attr("name"),"data-level":o+1}
i.name=i.name.substr(0,i.name.lastIndexOf("["))+"["+(o+1)+"]",e.root.attr("required")&&(i.required=!0)
var a=$("<select/>",i)
a.append('<option value="" selected'+(e.root.attr("required")?" disabled":"")+"></option>"),$.each(e.data[o+1][n.val()],function(t,e){a.append('<option value="'+t+'">'+e+"</option>")}),n.after(a)}},this.root=$(t),this.data=JSON.parse(this.root.attr("data-values")),this.root.attr("data-values",null),this.root.on("change","select",this.onChange)}return t.check=function(){return!0},t}()
t.MLSelect=e}(UI||(UI={}))
var UI
!function(t){var e=function(){function t(t){var e=this
this.onVote=function(t){$.post("/!Poll",{id:e.root.attr("widget"),vote:e.root.find("input:checked").val()},function(t){e.root=e.root.replaceWith(t)})},this.root=$(t)
var n=this.root.find('[qtype="button"]')
n.attr("disabled")||n.click(this.onVote)}return t.check=function(){return!0},t}()
t.Poll=e}(UI||(UI={}))
var UI
!function(t){var e=function(){function e(t){this.$item=$(t)
var e=this.$item.val().split(";")
console.log(e)
var n={type:"double",from:"undefined"!=typeof e[0]?e[0]:0,to:"undefined"!=typeof e[1]?e[1]:this.$item.attr("max")?this.$item.attr("max"):1,min:this.$item.attr("min")?this.$item.attr("min"):0,max:this.$item.attr("max")?this.$item.attr("max"):1,step:this.$item.attr("step")?this.$item.attr("step"):1,values:this.$item.attr("values")?this.$item.attr("values").split(","):null}
this.$item.ionRangeSlider(n)}return e.check=function(){if("function"==typeof $.fn.ionRangeSlider)return!0
throw window.loader.on("range",function(){t.Controll.load("Range")}),"waiting for other js file"},e}()
t.Range=e}(UI||(UI={}))
var UI
!function(t){var e=function(){function t(t){var e=this
this.move=function(t){var n=Math.ceil(t.offsetX/e.item.width()*10)/2
e.setHover(n)},this.click=function(t){e.move(t),$.post("/!Rating",{id:e.item.attr("widget"),target:e.item.attr("target"),value:e.item.attr("rating-value")},function(t){e.item=e.item.replaceWith(t)})},this.item=$(t),this.item.click(this.click),this.item.mousemove(this.move),this.item.mouseleave(function(){e.setHover(0)})}return t.prototype.setHover=function(t){this.item.attr("rating-value",t).find(".hover").css("width",20*t+"%")},t.check=function(){return!0},t}()
t.Rating=e}(UI||(UI={}))
var UI
!function(t){var e=function(){function t(t){var e=this
this.onAdd=function(t){var n=e.select.find("option:selected")
if(!n.attr("disabled")){var o=n.attr("value")
n[0].selected=!1,e.select.find("option")[0].selected=!0,e.select.after($("<div/>",{qtype:"SIPart"}).append([$("<span/>",{text:n.text()}),$("<input/>",{type:"hidden",name:e.root.attr("name")+"["+o+"][id]",value:o}),$("<label/>",{text:e.root.attr("data-required")}).prepend($("<input/>",{type:"checkbox",name:e.root.attr("name")+"["+o+"][required]",value:1,text:"Required"})),$("<label/>",{text:e.root.attr("data-filter")}).prepend($("<input/>",{type:"checkbox",name:e.root.attr("name")+"["+o+"][filter]",value:1,text:"Required"}))])),n.remove()}},this.onRemove=function(t){var n=$(t.currentTarget).parent()
e.select.append($("<option>",{value:n.find('input[type="hidden"]').val(),text:n.contents()[0].textContent.trim()})),n.remove()},this.onEnter=function(t){var e=$(t.currentTarget)
e.append('<span qtype="remove"/>')},this.onLeave=function(t){var e=$(t.currentTarget)
e.find('[qtype="remove"]').remove()},this.root=$(t),this.select=this.root.find("select"),this.select.change(this.onAdd),this.root.on("mouseenter",'[qtype="SIPart"]',this.onEnter),this.root.on("mouseleave",'[qtype="SIPart"]',this.onLeave),this.root.on("click",'[qtype="remove"]',this.onRemove)}return t.prototype.update=function(){},t.check=function(){return!0},t}()
t.SchemasInput=e}(UI||(UI={}))
var UI
!function(t){var e=function(){function t(t){var e=this
this.onKeyPress=function(t){var n=String.fromCharCode(t.which)
if(e.root.attr("seporators").indexOf(n)>-1){t.preventDefault()
var o=e.input.val().substr(0,e.input[0].selectionStart)
o.length&&(e.value.before($("<span/>",{qtype:"SLPart"}).text(o)),e.input.val(e.input.val().substr(e.input[0].selectionEnd)),e.input[0].selectionStart=e.input[0].selectionEnd=0),e.update()}else 32==t.keyCode&&(t.preventDefault(),e.input.val(e.input.val()+"_"))},this.onKeyDown=function(t){if(8==t.keyCode&&0==e.input[0].selectionStart){var n=e.root.find('[qtype="SLPart"]').last()
n&&(e.input.val(n.text()+e.input.val().substr(e.input[0].selectionEnd)),e.input[0].selectionStart=e.input[0].selectionEnd=n.text().length,n.remove(),t.preventDefault())}},this.onFocus=function(t){var n=$(t.currentTarget)
n.parent().attr("focus","focus"),e.update()},this.onBlur=function(t){var n=$(t.currentTarget)
n.parent().attr("focus",null),e.update()},this.root=$(t),this.input=this.root.find('[qtype="SLInput"]'),this.value=this.root.find('[qtype="SLValue"]'),this.root.click(function(t){e.input.focus()}),this.input.keydown(this.onKeyDown).keypress(this.onKeyPress).focus(this.onFocus).blur(this.onBlur)}return t.prototype.update=function(){var t="",e=this.root.attr("seporators").substr(0,1)
this.root.find('[qtype="SLPart"]').each(function(){t+=$(this).text()+e}),t+=this.input.val(),this.value.val(t)},t.check=function(){return!0},t}()
t.StringList=e}(UI||(UI={}))
var UI
!function(t){var e=function(){function t(t){var e=this
this.onKeyDown=function(t){if(8==t.keyCode&&0==e.input[0].selectionStart&&null!=e.root.attr("multypart")){var n=e.root.find('[qtype="UrlPart"]').last()
n&&!n.is("[static]")&&(e.input.val(n.text()+e.input.val().substr(e.input[0].selectionEnd)),e.input[0].selectionStart=e.input[0].selectionEnd=n.text().length,n.remove(),e.update(),t.preventDefault())}},this.onKeyPress=function(t){if(47==t.charCode){t.preventDefault()
var n=e.input.val().substr(0,e.input[0].selectionStart)
if(n.length&&null!=e.root.attr("multypart")){{e.root.find('[qtype="UrlPart"]').last()}e.value.before($("<span/>",{qtype:"UrlPart"}).text(n)),e.input.val(e.input.val().substr(e.input[0].selectionEnd)),e.input[0].selectionStart=e.input[0].selectionEnd=0}}else 32==t.keyCode&&(t.preventDefault(),e.input.val(e.input.val()+"_"))
e.update()},this.onFocus=function(t){var n=$(t.currentTarget)
n.parent().attr("focus","focus"),e.update()},this.onBlur=function(t){var n=$(t.currentTarget)
n.parent().attr("focus",null),e.update()},this.onPaste=function(t){e.update(),setTimeout(function(){e.input.val(slug(e.input.val(),{replacement:"_"}))},0)},this.root=$(t),this.value=this.root.find('[qtype="UrlValue"]'),this.input=this.root.find('[qtype="UrlInput"]'),this.input.keydown(this.onKeyDown).keypress(this.onKeyPress).change(function(){e.update()}).focus(this.onFocus).blur(this.onBlur).on("paste",this.onPaste),this.root.click(function(t){e.input.focus()})
var n=this.root.find('[qtype="UrlRefresh"]')
n.length>0&&n.click(function(t){var o=e.root.parents("form").first().find("#"+n.attr("data-id"))
o.length>0&&e.input.val(slug(o.val()))}),this.update(),$(window).load(function(){e.update()})}return t.prototype.update=function(){var t=""
null!=this.root.attr("absolute")?(this.root.find('[qtype="UrlPart"]').each(function(){t+="/"+$(this).text()}),t+="/"+this.input.val()):(this.root.find('[qtype="UrlPart"]').not("[static]").each(function(){t+=$(this).text()+"/"}),t+=this.input.val()),this.value.val(t)},t.check=function(){return!0},t}()
t.Url=e}(UI||(UI={}))
var UI
!function(t){var e=function(){function t(){}return t.add=function(e){t.unloads.push(e)},t.ckeck=function(){$(window).on("beforeunload",function(e){for(var n=[],o=0;o<t.unloads.length;o++){var i=t.unloads[o]()
"String"==typeof i&&-1==n.indexOf(i)&&n.push(i)}return n.length>0?n.join("\n"):void 0})},t.unloads=[],t}()
t.Unload=e}(UI||(UI={})),$(function(){UI.Controll.init(document.body)})
